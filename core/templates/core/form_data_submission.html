{% extends 'base.html' %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block content %}
    <span class="mb-2 h4">{{ dataset.cruise.name }} - {{ dataset.cruise.descriptor }}</span>
    {% if user.is_authenticated and data_form %}
    <form id="form_id_data" class="mb-2" enctype="multipart/form-data"
          hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
          hx-encoding="multipart/form-data">

        {% crispy data_form %}
        <div id="div_id_files" class="mb-3">
            <label for="id_files" class="form-label">
                Upload Files
            </label>
            <div><input type="file" name="files" class="form-control" multiple="" id="id_files"> </div>
        </div>
        <button id="btn_id_form_submit" type="button" hx-swap="none" hx-post="{% url 'core:submit_data' dataset.id %}" class="btn btn-primary">
            <span class="bi bi-check-square"></span>
        </button>
    </form>
    {% endif %}
    <div id="div_id_file_list" class="table-responsive" style="max-height: 400px; overflow-y: auto;" hx-get="{% url 'core:update_file_list' dataset.pk %}" hx-trigger="update_file_list from:body">
        <table class="table table-sm table-striped">
            <thead>
            <tr>
                <th>{% trans 'File Name' %}</th>
                <th>{% trans 'File Location' %}</th>
                <th>{% trans 'Submitted By' %}</th>
                <th>{% trans 'Submitted Date' %}</th>
            </tr>
            </thead>
            <tbody>
            {% for file in dataset.data_files.all %}
                <tr>
                    <td>{{ file.file_name }}</td>
                    <td>{{ file.file }}</td>
                    <td>{{ file.submitted_by }}</td>
                    <td>{{ file.submitted_date }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

